<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Event-Based Camera Simulator</title>
  <style>
    body {
      margin: 0; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: #111; color: #eee; font-family: sans-serif;
    }
    video, canvas { border-radius: 12px; margin: 10px; }
    #controls { margin: 10px; }
  </style>
</head>
<body>
  <h2>Event-Based Camera Simulator</h2>
<p style="max-width:600px; text-align:center; color:#bbb;">
  This simulator demonstrates how an event-based (neuromorphic) camera captures visual
  information differently from a traditional frame-based camera. Move your hand in front of
  the webcam to see motion-triggered “events” instead of continuous frames.
</p>
  <video id="video" width="480" height="360" autoplay muted></video>
  <canvas id="canvas" width="480" height="360"></canvas>
<div style="margin-top:20px; text-align:center; color:#ddd;">
  <h3>How It Works</h3>
  <p style="max-width:600px; margin:auto;">
    Unlike normal cameras that record frames, event cameras detect pixel-level changes in brightness.
    White pixels represents change in intensity, therefore it is called an event. The red pixels, on 
    the other hand, are the ones that do not show change.
  </p>
</div>
  <div id="controls">
    Threshold: <input type="range" id="threshold" min="5" max="60" value="25" />
    <span id="threshVal">25</span>
  </div>

  <!-- Load OpenCV for JS -->
  <script async src="https://docs.opencv.org/4.x/opencv.js"></script>
  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const slider = document.getElementById("threshold");
    const threshVal = document.getElementById("threshVal");

    // Wait for OpenCV to load
    let Module = { onRuntimeInitialized: start };
    function start() {
      // Access webcam
      navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
        video.srcObject = stream;
        video.play();
        processLoop();
      });

      let prevGray = null;
      function processLoop() {
        if (video.readyState >= 2) {
          const w = video.videoWidth, h = video.videoHeight;
          ctx.drawImage(video, 0, 0, w, h);
          let src = cv.imread(canvas);
          let gray = new cv.Mat();
          cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);

          if (prevGray) {
            let diff = new cv.Mat();
            cv.subtract(gray, prevGray, diff);        // signed difference
            let pos = new cv.Mat(), neg = new cv.Mat();
            let absDiff = new cv.Mat();
            let thr = parseInt(slider.value);

            // Positive polarity (brightness increase)
            cv.threshold(diff, pos,  thr, 255, cv.THRESH_BINARY);
            // Negative polarity (brightness decrease)
            cv.threshold(diff, neg, -thr, 255, cv.THRESH_BINARY_INV);
            cv.absdiff(gray, prevGray, absDiff);
            cv.threshold(absDiff, absDiff, thr, 255, cv.THRESH_BINARY);

            // Visualize: white = +polarity, red = –polarity
            let posColor = new cv.Mat(), negColor = new cv.Mat();
            cv.cvtColor(pos, posColor, cv.COLOR_GRAY2RGBA);
            cv.cvtColor(neg, negColor, cv.COLOR_GRAY2RGBA);

            for (let y = 0; y < h; y++) {
              for (let x = 0; x < w; x++) {
                if (pos.ucharPtr(y, x)[0] > 0)
                  ctx.fillStyle = "white", ctx.fillRect(x, y, 1, 1);
                else if (neg.ucharPtr(y, x)[0] < 255)
                  ctx.fillStyle = "red", ctx.fillRect(x, y, 1, 1);
              }
            }

            diff.delete(); pos.delete(); neg.delete();
            absDiff.delete(); posColor.delete(); negColor.delete();
          }

          prevGray = gray.clone();
          src.delete(); gray.delete();
        }

        requestAnimationFrame(processLoop);
      }

      slider.oninput = () => (threshVal.textContent = slider.value);
    }
  </script>
<footer style="margin-top:40px; color:#777; font-size:14px;">
  © 2025 Srishti Baid & Ashmita Basumallick — Event Camera Simulation Project
</footer>
</body>
</html>
